---
layout: post
title:  "Ubuntu用户及用户组管理"
date:  2016-05-20
categories: linux ubuntu
comments: true
excerpt:
---

* content
{:toc}

### Linux常用用户管理常用命令

Linux是一个用户权限管理得很严格的系统，Ubuntu作为最受欢迎的桌面发行版，提供了简单易用的图形界面工具来管理用户，但是命令行工具往往更强大，用得熟练的话效率会更高。用户管理命令常用的有如下几个：

`useradd` 这个命令用于添加用户，相比图形界面工具，它可以指定用户文件夹，所属群组等。

如果执行useradd -D不加任何其它参数，bash将返回当前创建用户的默认选项，如果附加其他参数，那么这个命令就会把新建用户的默认配置更新到当前值。

`-m`选项可以在/home/下建立相应的用户文件夹  
-p选项可以设置密码  
`-s`选项可以设定shell  
-u选项可以设定UID
 
---

`userdel` 这个命令用于删除用户，如果不加附加参数，则默认只删除用户  
`-r`选项，则同时删除用户目录和用户帐户。
 
---

`passwd` 这个命令用于修改用户密码，也可以修改群组密码。常用附加参数如下：
-l 效果相当于usermod -L，会禁用用户账户，需要root权限。  
-u 效果相当于usermod -U，用于回复被禁用的账户，需要root权限。  
-g 修改组密码。  
-d 关闭用户的密码认证功能，使其在登录时不需要输入密码，需要root权限。  

---

`usermod` 这个命令用于更改用户属性，-s可以更改用户shell，-u可以更改UID，如果用户已登录，就不可以更改用户属性。
 
`chsh` 这个命令用于更改用户的shell。
 
`w` 这个如此简单的命令可以返回系统当前登录用户的详细状态，如果w username就可以返回特定用户的状态。
 
`ac` 这个命令可以返回用户总的连接时间，它从/var/log/wtmp文件中获取信息，这个命令貌似Ubuntu没有自带，需要安装acct软件包。
 
`last` 这个命令从/var/log/wtmp中获取信息，可以列出从该文件创建起所有用户的登录记录。
 
`lastb` 这个命令可以列出所有登录失败的记录，在系统安全方面有一定作用。

---

### 用户和用户组管理的文件
 
Linux的多用户概念是指多个用户同时可以使用这个系统。
 
1.用户帐号文件——passwd
  
Passwd 是一个文本文件（每一行标识1个用户），定义了系统的用户帐号，该文件位于“/etc”目录下。
  
文件中包含了一个系统帐户列表，存放了每个账户一些有用的信息，如*用户ID,组ID，主目录，shell*等等（用“：”分隔开来）。
  
只定义了用户帐号，而不保存口令（用“x”表示，如果没有 sun：：则表示没有密码）。

真正的密码存放在`Shadow`文件中，普通用户根本不能读，加密后的密文无法读到就可以提高用户帐号的安全性。

例如：

	$ head /etc/passwd  
 
root:x:0:0:root:/root:/bin/bash 表示有7个字段：  
`登录名:有无口令：用户ID:组ID:账户备注信息：用户Home目录：登录时用户shell的名称（超级用户有权限修改）`
 
2.用户口令文件——shadow
  
每行定义了一个用户信息，行中各字段用：分开，为进一步提高安全性，口令文件存放用户已经加密的口令：*,特殊符号

	$ head /etc/shadow  
 
	1:2:3:4:5:6:7:8:9

	1-登录名:
	2-加密的口令（用*或其他特殊字符表示）:  
	3-上次更改口令距离1970.1.1的天数：  
	4-口令更改后不可更改的天数：  
	5-口令更改后必须再更改的天数（有效期）：  
	6-口令失效前警告用户的天数：  
	7-口令失效后距帐号被查封的天数：  
	8-帐号被封时距1970.1.1的天数：  
	9-保留未用。
 
3.用户组帐号文件——group 
 
用户组：逻辑的组织用户帐号的集合的方式，用户允许在其组内共享文件，系统每个文件都有一个用户和附属的用户组。使用“ls -l”命令可以查看每个文件的属性和组。

	$ head /etc/group  
 
root:x:0:root,tom,mary   
`组名：组加密口令：GID：组成员列表（用，隔开的每个组用户名`
 
4.用户组口令文件——gshadow

用于定义用户组口令，用户组管理员信息。该文件只有超级用户root才可以读取
每行记录信息：

	$ head /etc/gshadow  

`用户组：用户组加密口令：组管理员帐号（管理员有权进行增删帐号）：组成员列表`

---

### 用户和用户组管理的命令

1.增加用户账户：`useradd 用户名`  
`useradd –g 组名 用户名` 指定该用户所使用的私有组名，默认是与用户帐号同名的私有组。  

	`useradd –D [-g group][-b base][-s shell][-f inactive][-e expire][-d home-dir][-m create-home]` 

用于显示和设置useradd该命令所使用的默认值。  

例如：
	$ useradd scott        //建立用户帐号
	$ tail -l /etc/passwd  //查询passwd中添加的用户账户的信息
	$ tail –l /etc/shadow
	$ ls /home             //查看所建立帐号的主目录
 
2.修改用户帐号属性：

	usermod [-LU][-c ][-d ][-e ][-f ][-g ][-G][-l][-s][-u][用户帐号]
 
3.删除用户帐号：

	userdel [-r][用户帐号] //如果不加参数则只删除用户帐号，不删除文件，否则两者都删除。
	userdel [-r][用户帐号] //-r用来删除帐号登入目录和目录中所有文件
 
举例：

	$ grep sun /etc/passwd     //查询用户帐号scott是否存在
	$ userdel scott            //删除用户帐号scott
	$ grep scott /etc/passwd   //再次查询用户帐号scott是否存在
	$ ll –d /home              //查询用户scott主目录是否存在
	$ userdel –r scott         //删除用户的同时，删除其工作主目录
 
4.增加用户组帐号：`groupadd [-r][组帐号]`

>注意 : 帐号ID唯一，数值不可为负，预设最小值不得小于500，且每增加一个，组帐号ID逐次自增1。其中-r参数是用来建立系统帐号的。0～499是给系统帐号准备的。
 
举例：

	$ groupadd magicSun         //建立组账户magicSun
	$ grep magicSun /etc/group  //查询group文件中magicSun组账户是否建立
	$ groupadd –r sysWang       //建立系统组账户sysWang
	$ grep sysWang /etc/group   //查询group文件中sysWang系统组账户是否建立
 
5.修改组帐号：
	
	groupmod [-g ][-n][群组名称]

其中`-o`表示重复使用群组识别码
 
6.删除组帐号：

	groupdel [群组名称]

>注意 : 必须先删除组中的用户才能删除该组
 
7.口令维护：
	
	passwd [-s][-l][-u][-d][用户名]
 
超级用户可以为每一位新增的用户设置口令，普通用户只能用不带参数的passwd命令来修改自己的口令。  
其中参数  
-s表示用于查询指定用户帐号的状态  
-l用户锁定帐号的口令  
-u解锁帐号口令  
-d删除指定帐号的口令  
 
8.组用户成员维护：将一个账户添加到组、或将一个账户从组中删除、将一个账户设为组管理员。
  
	gpasswd –a 用户帐号名 组帐号名       # 添加用户到组
	gpasswd –d 用户帐号名 组帐号名       # 从组中删除用户  
	gpasswd –A 组管理员用户列表 用户组   # 设置用户为组管理员
 
9.用户和组的状态命令：

	id [选项] [用户名称]  # 用于显示用户当前UID，gid以及所属群组的组列表  
[选项]参数有：  
-g:显示用户所属群组的id  
-G:显示用户所属附加群组的id  
-n:显示用户所属群组或附加群组的名称  
-r:显示实际ID  
-u:显示用户ID  

`whoami` 用于显示登录者自身的名称(=id -un)

`su [-flmp] [-][-c ][-s][用户帐号]`    
用来将当前用户转换为其他用户身份，暂时变更自己的登录身份，用其他人的身份来登录系统。前提是必须知道对方的口令。其中参数-c表示执行完指定的指 令后恢复原来的身份。-f适用于csh和tsch,使shell不用去读取启动文件。-表示改变身份时也同时变更工作目录，以及 HOME，SHELL,USER,LOGNAME，此外也会变更PATH环境变量。-m,-p 变更身份时不变更环境变量。-s 指定要执行的shell。若不指定要变更的用户账户，那么预设为root超级用户。
 
`groups [用户名称]` 用于显示指定用户所属的组，若未指定用户则显示当前用户所属组

---

### 其他相关

**runlevel**

查看当前的运行级别，Ubuntu 桌面默认是2。    
Ubuntu 的系统运行级别： 
 
	0        系统停机状态
	1        单用户或系统维护状态
	2~5      多用户状态
	6        重新启动 
	S

运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动  
运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆  
运行级别2：多用户状态(没有NFS)  
运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式  
运行级别4：系统未使用，保留  
运行级别5：X11控制台，登陆后进入图形GUI模式  
运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动  

切换运行级别，执行命令：  
`init [0123456Ss]`  
即在 init 命令后跟一个参数，此参数是要切换到的运行级的运行级代号，如：用 init 0 命令关机；用 init 6 命令重新启动。

---

**whois**
 
功能说明：查找并显示用户信息。  
语　　法：`whois [帐号名称]`   
补充说明：whois指令会去查找并显示指定帐号的用户相关信息，因为它是到Network Solutions 的WHOIS数据库去查找，所以该帐号名称必须在上面注册方能寻获，且名称没有大小写的差别。

---

**whoami**

功能说明：显示用户名称。  
语　　法：`whoami [--help][--version]`  
补充说明：显示自身的用户名称，本指令相当于执行"id -un"指令。  

---

**who**

功能说明：显示目前登入系统的用户信息。  
语　　法：`who [-Himqsw][--help][--version][am i][记录文件]`  
补充说明：执行这项指令可得知目前有那些用户登入系统，单独执行who指令会列出登入帐号，使用的终端机，登入时间以及从何处登入或正在使用哪个X显示器。  
参　　数：

	-H或--heading   显示各栏位的标题信息列。
	-i或-u或--idle  显示闲置时间，若该用户在前一分钟之内有进行任何动作，将标示成"."号，如果该用户已超过24小时没有任何动作，则标示出"old"字符串。
	-m              此参数的效果和指定"am i"字符串相同。
	-q或--count     只显示登入系统的帐号名称和总人数。
	-s              此参数将忽略不予处理，仅负责解决who指令其他版本的兼容性问题。
	-w或-T或--mesg或--message或--writable 　显示用户的信息状态栏。
	--help          在线帮助。
	--version       显示版本信息。

---

**w**

功能说明：显示目前登入系统的用户信息。  
语　　法：`w [-fhlsuV][用户名称]`  
补充说明：执行这项指令可得知目前登入系统的用户有那些人，以及他们正在执行的程序。单独执行w,指令会显示所有的用户，您也可指定用户名称，仅显示某位用户的相关信息。  
参　　数：

	-f 　开启或关闭显示用户从何处登入系统。
	-h 　不显示各栏位的标题信息列。
	-l 　使用详细格式列表，此为预设值。
	-s 　使用简洁格式列表，不显示用户登入时间，终端机阶段作业和程序所耗费的CPU时间。
	-u 　忽略执行程序的名称，以及该程序耗费CPU时间的信息。
	-V 　显示版本信息。

---

**finger**

finger命令的功能是查询用户的信息，通常会显示系统中某个用户的用户名、主目录、停滞时间、登录时间、登录shell等信息。如果要查询远程机上的 用户信息，需要在用户名后面接“@主机名”，采用[用户名@主机名]的格式，不过要查询的网络主机需要运行finger守护进程。

语法：`finger [选项] [使用者] [用户@主机]`  
参   数：

	-s   显示用户的注册名、实际姓名、终端名称、写状态、停滞时间、登录时间等信息。
	-l   除了用-s选项显示的信息外，还显示用户主目录、登录shell、邮件状态等信息，以及用户主目录下的.plan、.project和.forward文件的内容。
	-p   除了不显示.plan文件和.project文件以外，与-l选项相同。

