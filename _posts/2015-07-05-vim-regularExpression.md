---
layout: post
title:  "Vim与正则表达式"
date:  2015-07-05 
categories: linux shell
comments: true
excerpt:
---

* content
{:toc}

<br />

Vim中的正则表达式功能很强大，如果能自由运用，则可以完成很多难以想象的操作。

### 一、使用正则表达式的命令  

使用正则表达式的命令最常见的就是 `/` （搜索）命令。其格式如下：  
`/正则表达式`  

另一个很有用的命令就是 `:s`（替换）命令，将第一个//之间的正则表达式替换成第二个//之间的字符串。  
`:s/正则表达式/替换字符串/选项`  

在学习正则表达式时可以利用 / 命令来练习。  

---

### 二、元字符

元字符是具有特殊意义的字符。使用元字符可以表达任意字符、行首、行 尾、某几个字符等意义。

元字符一览


`.`	匹配任意一个字符  
`[abc]`	匹配方括号中的任意一个字符。可以使用-表示字符范围，如[a-z0-9]匹配小写字母和阿拉伯数字。  
`[^abc]`	在方括号内开头使用^符号，表示匹配除方括号中字符之外的任意字符。  
`\d` 匹配阿拉伯数字，等同于[0-9]。  
`\D` 匹配阿拉伯数字之外的任意字符，等同于[^0-9]。  
`\x` 匹配十六进制数字，等同于[0-9A-Fa-f]。  
`\X` 匹配十六进制数字之外的任意字符，等同于[^0-9A-Fa-f]。  
`\w` 匹配单词字母，等同于[0-9A-Za-z_]。  
`\W` 匹配单词字母之外的任意字符，等同于[^0-9A-Za-z_]。  
`\t` 匹配<TAB>字符。  
`\s` 匹配空白字符，等同于[ \t]。  
`\S` 匹配非空白字符，等同于[^ \t]。  

另外，如果要查找字符 *、.、/等，则需要在前面用 \ 符号，表示这不是元字符，而只是普通字符而已。  
转义字符  
`\*` 匹配 * 字符。  
`\.` 匹配 . 字符。  
`\/` 匹配 / 字符。  
`\\` 匹配 \ 字符。  
`\[` 匹配 [ 字符。  


表示数量的元字符  
`*` 匹配0-任意个  
`\+` 匹配1-任意个  
`\?` 匹配0-1个  
`\{n,m}` 匹配n-m个  
`\{n}` 匹配n个  
`\{n,}` 匹配n-任意个
`\{,m}` 匹配0-m个

表示位置的符号  
`$` 匹配行尾  
`^` 匹配行首  
`\<` 匹配单词词首  
`\>` 匹配单词词尾  

Example:  
`/char\s\+[A-Za-z_]\w*;`--查找所有以char开头，之后是一个以上的空白，最后是一个标识符和分号  
`/\d\d:\d\d:\d\d`--查找如 17:37:01 格式的时间字符串  
`:g/^\s*$/d`--删除只有空白的行  
`:s/\<four\>/4/g`--将所有的four替换成4，但是fourteen中的four不替换  

---

### 三、替换变量

在正规表达式中使用 \( 和 \) 符号括起正规表达式，即可在后面使用\1、\2 等变量来访问 \( 和 \) 中的内容。  

Example:  
`/\(a\+\)[^a]\+\1`--查找开头和结尾处a的个数相同的字符串，如aabbbaa，aaacccaaa，但是不匹配abbbaa  
`:s/\(http:\/\/[-a-z\._~\+%\/]\+\)/<a href="\1">\1<\/a>/`--将URL替换为\<a href="http://url"\>http://url\</a\>的格式  
`:s/\(\w\+\)\s\+\(\w\+\)/\2\t\1`--将data1data2修改为data2data1  

---

### 四、函数式

在替换命令 s/// 中可以使用函数表达式来书写替换内容，格式为  

:s/替换字符串/\=函数式  
在函数式中可以使用 submatch(1)、submatch(2) 等来引用 \1、\2 等的内容，而submatch(0)可以引用匹配的整个内容。  

Example:  
`:%s/\<id\>/\=line(".")`--将各行的id字符串替换为行号  
`:%s/^\<\w\+\>/\=(line(".")-10).".".submatch(1)`--将每行开头的单词替换为(行号-10).单词的格式，如第11行的word替换成1.word 
---

### 五、零宽断言

与perl相比，(?换成了\@，并且这个符号应该跟在匹配模式的后边。  

	vim   Perl   意义 
	\@=   (?=    顺序环视 
	eg:查找后面是sql的my： /my\(sql\)\@=

	\@!   (?!    顺序否定环视 
	eg:查找后面不是sql的my： /my\(sql\)\@!

	\@<=   (?<=  逆序环视 
	eg: 查找前面是my的sql： /\(my\)\@<=sql

	\@<!   (?<!  逆序否定环视 
	eg:查找前面不是my的sql： /\(my\)\@<!sql

	\@>   (?>    固化分组 

	\%(atom\)   (?:  非捕获型括号
	意思是，此分组不捕获，可以理解为不算在分组信息中，eg：
	:%s/\%(my\)sql\(ok\)/\1
	上面的命令会将mysqlok替换为 ok ，由于my为捕获在分组中，故组中\1 为ok。

---

### 六、其他

在各种常用工具对比中，我看到vim是支持计数的，而且似乎大部分常用的正则元字符都与perl兼容，比如\s,\d,\D,\w,\W, < >。但vim不支持\b，即单次边界。

另外，vim中比较麻烦的是它似乎支持的是BRE（基本正则表达式，posix定义的），BRE中所有括号都不是元字符，因为作为元字符的是\(,\{。比如vim中匹配连续3个9，你得用9\{3\}，原来我一直以为不支持，但我还是觉得麻烦了一点，grep默认也是使用的这种BRE。VIM中匹配999也可以写成9\{3}，也就是说少了结尾的\。
